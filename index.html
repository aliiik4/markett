        {/* Market Overview Charts */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* Market Cap Distribution */}
          <div className="bg-slate-900/50 rounded-xl p-6 border border-slate-800 backdrop-blur">
            <h3 className="text-2xl font-bold mb-4 flex items-center gap-2">
              <PieChartIcon className="text-orange-400" />
              Top 10 Market Cap Distribution
            </h3>
            <ResponsiveContainer width="100%" height={300}>
              <PieChart>
                <Pie
                  data={cryptoData.slice(0, 10).map(coin => ({
                    name: coin.symbol,
                    value: coin.marketCap
                  }))}
                  cx="50%"
                  cy="50%"
                  labelLine={false}
                  label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(1)}%`}
                  outerRadius={100}
                  fill="#8884d8"
                  dataKey="value"
                >
                  {cryptoData.slice(0, 10).map((_, index) => (
                    <Cell key={`cell-${index}`} fill={`hsl(${index * 36}, 70%, 60%)`} />
                  ))}
                </Pie>
                <Tooltip formatter={(value) => formatNumber(value)} />
                <Legend />
              </PieChart>
            </ResponsiveContainer>
          </div>

          {/* Price Performance Heatmap */}
          <div className="bg-slate-900/50 rounded-xl p-6 border border-slate-800 backdrop-blur">
            <h3 className="text-2xl font-bold mb-4 flex items-center gap-2">
              <TrendingUpDown className="text-green-400" />
              Top 10 Cryptocurrency Performance
            </h3>
            <ResponsiveContainer width="100%" height={300}>
              <ComposedChart data={cryptoData.slice(0, 10)}>
                <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                <XAxis dataKey="symbol" stroke="#94a3b8" fontSize={12} />
                <YAxis stroke="#94a3b8" fontSize={12} />
                <Tooltip 
                  contentStyle={{ backgroundColor: '#1e293b', borderColor: '#475569' }}
                  labelStyle={{ color: '#cbd5e1' }}
                  formatter={(value) => [`${value}%`, 'Change']}
                />
                <Legend />
                <Bar dataKey="change24h" fill="#3B82F6" name="24h Change" radius={[4, 4, 0, 0]} />
                <Line type="monotone" dataKey="change7d" stroke="#10B981" strokeWidth={2} name="7d Change" dot={false} />
              </ComposedChart>
            </ResponsiveContainer>
          </div>
        </div>

        {/* Volatility Analysis */}
        <div className="bg-slate-900/50 rounded-xl p-6 border border-slate-800 backdrop-blur">
          <h3 className="text-2xl font-bold mb-4 flex items-center gap-2">
            <Zap className="text-yellow-400" />
            Volatility Analysis (Top 20 by Market Cap)
          </h3>
          <ResponsiveContainer width="100%" height={300}>
            <ScatterChart margin={{ top: 20, right: 20, bottom: 20, left: 20 }}>
              <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
              <XAxis 
                type="number" 
                dataKey="marketCap" 
                name="Market Cap" 
                stroke="#94a3b8" 
                tickFormatter={(value) => `$${(value / 1e9).toFixed(0)}B`}
              />
              <YAxis 
                type="number" 
                dataKey="change24h" 
                name="24h Change %" 
                stroke="#94a3b8" 
                tickFormatter={(value) => `${value}%`}
              />
              <ZAxis type="number" dataKey="volume" range={[50, 400]} name="Volume" />
              <Tooltip 
                contentStyle={{ backgroundColor: '#1e293b', borderColor: '#475569' }}
                formatter={(value, name) => {
                  if (name === 'Market Cap') return [formatNumber(value), name];
                  if (name === '24h Change %') return [`${value}%`, name];
                  if (name === 'Volume') return [formatNumber(value), name];
                  return [value, name];
                }}
              />
              <Legend />
              <Scatter 
                name="Cryptocurrencies" 
                data={cryptoData.slice(0, 20)} 
                fill="#8884d8"
                shape={(props) => {
                  const { cx, cy, payload } = props;
                  return (
                    <g>
                      <circle cx={cx} cy={cy} r={Math.log(payload.volume) / 2} fill={`hsl(${Math.abs(payload.change24h) * 10}, 70%, 50%)`} opacity={0.7} />
                      <text x={cx} y={cy} textAnchor="middle" fill="white" fontSize={10}>
                        {payload.symbol}
                      </text>
                    </g>
                  );
                }}
              />
            </ScatterChart>
          </ResponsiveContainer>
        </div>
      </div>
    )}

    {/* Market Tab */}
    {activeTab === 'market' && (
      <div className="bg-slate-900/50 rounded-xl border border-slate-800 backdrop-blur overflow-hidden">
        {/* Controls */}
        <div className="p-4 border-b border-slate-800 flex flex-col md:flex-row gap-4 justify-between">
          <div className="relative flex-1">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-500" size={20} />
            <input
              type="text"
              placeholder="Search cryptocurrencies..."
              className="w-full pl-10 pr-4 py-3 bg-slate-950 border border-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
          
          <div className="flex gap-3">
            <select 
              className="px-4 py-3 bg-slate-950 border border-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500"
              value={sortBy}
              onChange={(e) => setSortBy(e.target.value)}
            >
              <option value="market_cap">Market Cap</option>
              <option value="volume">Volume</option>
              <option value="change_24h">24h Change</option>
              <option value="price">Price</option>
            </select>
            
            <select 
              className="px-4 py-3 bg-slate-950 border border-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500"
              value={timeframe}
              onChange={(e) => setTimeframe(e.target.value)}
            >
              <option value="24h">24h</option>
              <option value="7d">7d</option>
              <option value="30d">30d</option>
              <option value="1y">1y</option>
            </select>
          </div>
        </div>

        {/* Market Table */}
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="border-b border-slate-800">
                <th className="text-left p-4">#</th>
                <th className="text-left p-4">Coin</th>
                <th className="text-left p-4">Price</th>
                <th className="text-left p-4">24h Change</th>
                <th className="text-left p-4">7d Change</th>
                <th className="text-left p-4">Market Cap</th>
                <th className="text-left p-4">Volume (24h)</th>
                <th className="text-left p-4">Sparkline</th>
                <th className="text-left p-4">Actions</th>
              </tr>
            </thead>
            <tbody>
              {loading ? (
                <tr>
                  <td colSpan="9" className="p-8 text-center">
                    <div className="flex justify-center">
                      <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-orange-500"></div>
                    </div>
                  </td>
                </tr>
              ) : filteredData.map((coin) => (
                <tr 
                  key={coin.id} 
                  className="border-b border-slate-800 hover:bg-slate-800/30 transition-colors cursor-pointer"
                  onClick={() => loadCoinDetails(coin)}
                >
                  <td className="p-4">
                    <div className="font-bold text-slate-400">{coin.marketCapRank}</div>
                  </td>
                  <td className="p-4">
                    <div className="flex items-center gap-3">
                      <img src={coin.image} alt={coin.symbol} className="w-8 h-8 rounded-full" />
                      <div>
                        <div className="font-bold">{coin.name}</div>
                        <div className="text-sm text-slate-400">{coin.symbol}</div>
                      </div>
                      {watchlist.find(c => c.id === coin.id) && (
                        <Star className="w-4 h-4 text-yellow-400 fill-yellow-400" />
                      )}
                    </div>
                  </td>
                  <td className="p-4">
                    <div className="font-bold">{formatNumber(coin.price)}</div>
                  </td>
                  <td className="p-4">
                    <div className={`font-bold ${getChangeColor(coin.change24h)}`}>
                      {coin.change24h >= 0 ? '+' : ''}{coin.change24h.toFixed(2)}%
                    </div>
                  </td>
                  <td className="p-4">
                    <div className={`font-bold ${getChangeColor(coin.change7d)}`}>
                      {coin.change7d >= 0 ? '+' : ''}{coin.change7d.toFixed(2)}%
                    </div>
                  </td>
                  <td className="p-4">
                    <div className="font-bold">{formatNumber(coin.marketCap)}</div>
                  </td>
                  <td className="p-4">
                    <div>{formatNumber(coin.volume)}</div>
                  </td>
                  <td className="p-4">
                    <div className="w-32 h-10">
                      {coin.sparkline.length > 0 && (
                        <ResponsiveContainer width="100%" height="100%">
                          <LineChart data={coin.sparkline.map((price, index) => ({ value: price }))}>
                            <Line 
                              type="monotone" 
                              dataKey="value" 
                              stroke={coin.change24h >= 0 ? '#10B981' : '#EF4444'} 
                              strokeWidth={2}
                              dot={false}
                            />
                          </LineChart>
                        </ResponsiveContainer>
                      )}
                    </div>
                  </td>
                  <td className="p-4">
                    <button 
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleWatchlist(coin);
                      }}
                      className="p-2 hover:bg-slate-800 rounded-lg transition-colors"
                    >
                      <Star className={`w-5 h-5 ${watchlist.find(c => c.id === coin.id) ? 'text-yellow-400 fill-yellow-400' : 'text-slate-400'}`} />
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    )}

    {/* AI Scanner Tab */}
    {activeTab === 'ai-scanner' && (
      <div className="space-y-6">
        {/* Scanner Header */}
        <div className="bg-gradient-to-r from-purple-900/40 to-pink-900/40 rounded-xl p-6 border border-purple-500/50 backdrop-blur">
          <div className="flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
              <h3 className="text-3xl font-bold mb-2 flex items-center gap-3">
                <Brain className="text-purple-400 animate-pulse" />
                AI-Powered Crypto Scanner
              </h3>
              <p className="text-slate-300">Advanced analysis using momentum, volume, technical indicators, and market metrics</p>
            </div>
            
            <button
              onClick={runAIScanner}
              disabled={analyzing}
              className={`px-6 py-3 rounded-xl font-bold shadow-lg transition-all flex items-center gap-3 ${
                analyzing 
                  ? 'bg-slate-800 cursor-not-allowed' 
                  : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:shadow-xl hover:scale-105'
              }`}
            >
              {analyzing ? (
                <>
                  <RefreshCw className="animate-spin" />
                  Scanning...
                </>
              ) : (
                <>
                  <Brain />
                  Run AI Scanner
                </>
              )}
            </button>
          </div>
        </div>

        {/* Score Legend */}
        <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
          <div className="bg-gradient-to-r from-emerald-900/40 to-green-900/40 p-4 rounded-xl border border-emerald-500/50">
            <div className="text-xs text-emerald-300 mb-1">Score 80-100</div>
            <div className="font-bold text-lg">Strong Buy</div>
          </div>
          <div className="bg-gradient-to-r from-green-900/40 to-lime-900/40 p-4 rounded-xl border border-green-500/50">
            <div className="text-xs text-green-300 mb-1">Score 65-79</div>
            <div className="font-bold text-lg">Buy</div>
          </div>
          <div className="bg-gradient-to-r from-blue-900/40 to-cyan-900/40 p-4 rounded-xl border border-blue-500/50">
            <div className="text-xs text-blue-300 mb-1">Score 50-64</div>
            <div className="font-bold text-lg">Hold</div>
          </div>
          <div className="bg-gradient-to-r from-yellow-900/40 to-amber-900/40 p-4 rounded-xl border border-yellow-500/50">
            <div className="text-xs text-yellow-300 mb-1">Score 35-49</div>
            <div className="font-bold text-lg">Sell</div>
          </div>
          <div className="bg-gradient-to-r from-red-900/40 to-rose-900/40 p-4 rounded-xl border border-red-500/50">
            <div className="text-xs text-red-300 mb-1">Score 0-34</div>
            <div className="font-bold text-lg">Strong Sell</div>
          </div>
        </div>

        {/* AI Recommendations */}
        {topCoins.length > 0 && (
          <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
            {topCoins.slice(0, 9).map((coin, index) => (
              <div 
                key={coin.id} 
                className={`bg-gradient-to-br ${getScoreGradient(coin.aiScore.total)}/20 rounded-xl p-6 border backdrop-blur cursor-pointer hover:scale-[1.02] transition-transform`}
                onClick={() => loadCoinDetails(coin)}
              >
                <div className="flex justify-between items-start mb-4">
                  <div className="flex items-center gap-3">
                    <div className="relative">
                      <img src={coin.image} alt={coin.symbol} className="w-12 h-12 rounded-full" />
                      <div className="absolute -top-2 -right-2 bg-slate-900 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center border-2 border-slate-800">
                        {index + 1}
                      </div>
                    </div>
                    <div>
                      <div className="font-bold text-xl">{coin.symbol}</div>
                      <div className="text-sm text-slate-300">{coin.name}</div>
                    </div>
                  </div>
                  <div className="text-right">
                    <div className={`text-2xl font-bold ${getScoreColor(coin.aiScore.total)}`}>
                      {coin.aiScore.total}
                    </div>
                    <div className="text-xs text-slate-300">AI Score</div>
                  </div>
                </div>
                
                <div className="space-y-3 mb-4">
                  <div>
                    <div className="flex justify-between text-sm mb-1">
                      <span>Signal</span>
                      <span className="font-bold">{coin.aiScore.signal}</span>
                    </div>
                    <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                      <div 
                        className={`h-full bg-gradient-to-r ${getScoreGradient(coin.aiScore.total)}`}
                        style={{ width: `${coin.aiScore.total}%` }}
                      />
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-2 gap-3">
                    <div className="text-center">
                      <div className="text-xs text-slate-400">Risk</div>
                      <div className={`font-bold ${coin.aiScore.riskLevel === 'Low' ? 'text-green-400' : coin.aiScore.riskLevel === 'Medium' ? 'text-yellow-400' : 'text-red-400'}`}>
                        {coin.aiScore.riskLevel}
                      </div>
                    </div>
                    <div className="text-center">
                      <div className="text-xs text-slate-400">Confidence</div>
                      <div className="font-bold text-blue-400">{coin.aiScore.confidence.toFixed(1)}%</div>
                    </div>
                  </div>
                </div>
                
                <div className="grid grid-cols-2 gap-2">
                  {Object.entries(coin.aiScore.breakdown).map(([key, value]) => (
                    <div key={key} className="text-center">
                      <div className="text-xs text-slate-400 capitalize">{key}</div>
                      <div className="font-bold">{value}</div>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    )}

    {/* Coin Details Modal */}
    {coinDetails && (
      <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto">
        <div className="bg-gradient-to-br from-slate-900 to-slate-950 rounded-2xl border border-slate-800 w-full max-w-6xl max-h-[90vh] overflow-y-auto">
          {/* Modal Header */}
          <div className="p-6 border-b border-slate-800">
            <div className="flex justify-between items-start">
              <div className="flex items-center gap-4">
                <img src={coinDetails.image} alt={coinDetails.symbol} className="w-16 h-16 rounded-full" />
                <div>
                  <h2 className="text-3xl font-bold">{coinDetails.name} ({coinDetails.symbol})</h2>
                  <div className="flex items-center gap-3 mt-2">
                    <span className="text-2xl font-bold">{formatNumber(coinDetails.price)}</span>
                    <span className={`text-lg ${getChangeColor(coinDetails.change24h)}`}>
                      {coinDetails.change24h >= 0 ? '+' : ''}{coinDetails.change24h.toFixed(2)}%
                    </span>
                    <span className="px-3 py-1 bg-slate-800 rounded-lg text-sm">
                      Rank #{coinDetails.marketCapRank}
                    </span>
                  </div>
                </div>
              </div>
              
              <div className="flex gap-3">
                <button 
                  onClick={() => toggleWatchlist(coinDetails)}
                  className="p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors"
                >
                  <Star className={`w-6 h-6 ${watchlist.find(c => c.id === coinDetails.id) ? 'text-yellow-400 fill-yellow-400' : 'text-slate-400'}`} />
                </button>
                <button 
                  onClick={() => setCoinDetails(null)}
                  className="p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors"
                >
                  âœ•
                </button>
              </div>
            </div>
          </div>

          {/* Modal Content */}
          <div className="p-6 space-y-6">
            {/* Charts Row */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Price Chart */}
              <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-800">
                <h3 className="text-xl font-bold mb-4">Price Analysis (7D)</h3>
                <ResponsiveContainer width="100%" height={300}>
                  <ComposedChart data={coinDetails.priceHistory}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                    <XAxis dataKey="time" stroke="#94a3b8" fontSize={12} />
                    <YAxis stroke="#94a3b8" fontSize={12} />
                    <Tooltip />
                    <Legend />
                    <Line type="monotone" dataKey="price" stroke="#3B82F6" strokeWidth={2} dot={false} name="Price" />
                    <Line type="monotone" dataKey="sma20" stroke="#10B981" strokeDasharray="3 3" dot={false} name="SMA 20" />
                    <Line type="monotone" dataKey="sma50" stroke="#8B5CF6" strokeDasharray="3 3" dot={false} name="SMA 50" />
                    <Area type="monotone" dataKey="bbUpper" fill="#EF4444" stroke="none" opacity={0.1} />
                    <Area type="monotone" dataKey="bbLower" fill="#10B981" stroke="none" opacity={0.1} />
                  </ComposedChart>
                </ResponsiveContainer>
              </div>

              {/* Technical Indicators */}
              <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-800">
                <h3 className="text-xl font-bold mb-4">Technical Indicators</h3>
                {coinDetails.technicalAnalysis && (
                  <div className="grid grid-cols-2 gap-4">
                    <div className="text-center">
                      <div className="text-sm text-slate-400">RSI</div>
                      <div className={`text-2xl font-bold ${
                        coinDetails.technicalAnalysis.rsi < 30 ? 'text-green-400' : 
                        coinDetails.technicalAnalysis.rsi > 70 ? 'text-red-400' : 'text-blue-400'
                      }`}>
                        {coinDetails.technicalAnalysis.rsi.toFixed(2)}
                      </div>
                      <div className="text-xs text-slate-500">
                        {coinDetails.technicalAnalysis.rsi < 30 ? 'Oversold' : 
                         coinDetails.technicalAnalysis.rsi > 70 ? 'Overbought' : 'Neutral'}
                      </div>
                    </div>
                    <div className="text-center">
                      <div className="text-sm text-slate-400">MACD</div>
                      <div className={`text-2xl font-bold ${
                        coinDetails.technicalAnalysis.macd.histogram > 0 ? 'text-green-400' : 'text-red-400'
                      }`}>
                        {coinDetails.technicalAnalysis.macd.histogram.toFixed(4)}
                      </div>
                      <div className="text-xs text-slate-500">
                        {coinDetails.technicalAnalysis.macd.histogram > 0 ? 'Bullish' : 'Bearish'}
                      </div>
                    </div>
                    <div className="text-center">
                      <div className="text-sm text-slate-400">Support</div>
                      <div className="text-2xl font-bold text-green-400">
                        ${coinDetails.technicalAnalysis.support.toFixed(2)}
                      </div>
                    </div>
                    <div className="text-center">
                      <div className="text-sm text-slate-400">Resistance</div>
                      <div className="text-2xl font-bold text-red-400">
                        ${coinDetails.technicalAnalysis.resistance.toFixed(2)}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>

            {/* Additional Info */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-800">
                <div className="text-sm text-slate-400">Market Cap</div>
                <div className="text-xl font-bold">{formatNumber(coinDetails.marketCap)}</div>
              </div>
              <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-800">
                <div className="text-sm text-slate-400">24h Volume</div>
                <div className="text-xl font-bold">{formatNumber(coinDetails.volume)}</div>
              </div>
              <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-800">
                <div className="text-sm text-slate-400">Circulating Supply</div>
                <div className="text-xl font-bold">{coinDetails.circulatingSupply?.toLocaleString() || 'N/A'}</div>
              </div>
              <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-800">
                <div className="text-sm text-slate-400">Volume/MCap Ratio</div>
                <div className="text-xl font-bold">{coinDetails.volumeMarketCapRatio.toFixed(2)}%</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
                  </div>
